{% extends "base.html" %}
{% block title %}Historial de {{ cliente.nombre }}{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-4 mb-4">
    <div class="card card-soft shadow-sm text-center p-3">
      <div class="card-body">
        <h1 class="display-1 text-primary"><i class="bi bi-person-circle"></i></h1>
        <h3>{{ cliente.nombre }} {{ cliente.apellido }}</h3>
        <p class="text-muted mb-4">Cliente desde {{ cliente.fecha_registro|date:"Y" }}</p>
        <hr>
        <div class="row text-center">
          <div class="col-6">
            <h5>{{ pedidos.count }}</h5>
            <small>Pedidos Totales</small>
          </div>
          <div class="col-6">
            <h5 class="text-success">${{ total_gastado }}</h5>
            <small>Total Gastado</small>
          </div>
        </div>
        <div class="d-grid gap-2 mt-4">
          <a href="{% url 'ver_clientes' %}" class="btn btn-outline-secondary">Volver a Lista</a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-8">
    <div class="card card-soft shadow-sm">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Historial de Pedidos</h5>
      </div>
      <div class="card-body table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th># Orden</th>
              <th>Fecha</th>
              <th>Tipo</th>
              <th>Total</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            {% for p in pedidos %}
            <tr>
              <td class="fw-bold">#{{ p.numero_orden }}</td>
              <td>{{ p.fecha_pedido|date:"d/m/Y H:i" }}</td>
              <td>{{ p.tipo_orden }}</td>
              <td class="fw-bold">${{ p.total_pedido }}</td>
              <td>
                {% if p.pagado %}
                  <span class="badge bg-success">Pagado</span>
                {% else %}
                  <span class="badge bg-warning text-dark">Pendiente</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="5" class="text-center py-3">Este cliente a√∫n no ha realizado pedidos.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}